import{p as Qe,U as S,j as s,q as H,r as g,u as R,B as me,s as D,t as w,v as be,w as M,x as L,y as K,R as de,c as Q,z as k,D as fe,d as z,E as Ee}from"./index-CjbR5zlf.js";import{u as re,a as ie,U as q,C as pe,g as P,c as Ie,B as Ne,F as Te,T as Me,b as Le,d as he,e as je}from"./index-DbdGFxt5.js";import{u as ce,f as Ke,D as Ce,a as De}from"./data-table-row-actions-CWvKL5tc.js";import{S as G,a as J,b as Z,c as Y}from"./select-CBNmlDFn.js";import{z as n,u as we,t as ve,F as Fe,a as E,b as I,c as N,d as T,e as C}from"./form-BnLW7AoU.js";import{u as Oe}from"./use-ui-action-label-D2tLhJmv.js";import{I as qe}from"./input-number-nItHs7OP.js";import{M as Re}from"./multi-select-CI-sF_lY.js";import{g as ne}from"./get-select-options-BZMYMvLB.js";import{u as ee}from"./use-translated-object-DhGXam3-.js";import"./vendor-CLh72Zqc.js";import"./eye-CfiRFG4z.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],Ue=Qe("Phone",Pe);var $=(e=>(e.COMMITTEE_STAFFS="committee-staffs",e.TERRITORIAL_STAFFS="territorial-staffs",e))($||{});function ae(e,t="groups"){if(!e)return"";const r=e.replace(/\D/g,"");if(r.length<12||!r.startsWith("998"))return e;const l=r.slice(0,3),o=r.slice(3,5),m=r.slice(5,8),d=r.slice(8,10),u=r.slice(10,12);switch(t){case"readable":return`+${l} ${o} ${m} ${d} ${u}`;case"groups":return`+${l} (${o}) ${m}-${d}-${u}`;case"pretty":return`+${l} ${o} ${m}-${d}-${u}`;case"dashed":return`+${l}-${o}-${m}-${d}-${u}`;case"default":default:return`+${l}${o}${m}${d}${u}`}}const oe=(e,t,r=!1,i="")=>{if(!e||!Object.values(S).includes(e))return i;const o=e,m=t(`userRoles.${o}`,{defaultValue:i||o});return r?`${m} (${o})`:m},le=(e,t)=>e?s.jsx(H,{className:"bg-emerald-600/10 text-emerald-500 shadow-none px-4 py-1.5",children:t("active")}):s.jsx(H,{className:"bg-red-600/10 text-red-500 shadow-none px-4 py-1.5",children:t("inactive")}),ze=()=>{const{filters:e,setFilters:t}=ce({"active-tab":Ke.string($.COMMITTEE_STAFFS)}),{onOpen:r,isOpen:i}=re(),{onOpen:l,isOpen:o}=ie(),m=g.useMemo(()=>e["active-tab"],[e]),d=g.useCallback(a=>t(j=>({...j,"active-tab":a})),[t]),u=g.useCallback(()=>{r(q.CREATE)},[r]),y=g.useCallback(()=>{l(q.CREATE)},[l]);return{filters:e,activeTab:m,handleChangeTab:d,onAddCommitteeStaffs:u,onAddTerritorialStaffs:y,isOpenCommitteeStaffs:i,isOpenTerritorialStaffs:o}},_e=g.memo(({title:e,activeTab:t,onAddCommitteeStaffs:r,onAddTerritorialStaffs:i})=>{const{t:l}=R("common");return s.jsxs("div",{className:"flex justify-between",children:[s.jsx("h5",{className:"text-2xl font-semibold uppercase",children:e}),t===$.COMMITTEE_STAFFS?s.jsxs(me,{onClick:r,children:[s.jsx(pe,{}),l("actions.add_committee_staff")]}):s.jsxs(me,{onClick:i,children:[s.jsx(pe,{})," ",l("actions.add_territorial_staff")]})]})});_e.displayName="StaffsActionButton";const V={list:async e=>{const{data:t}=await D.getWithPagination(w.COMMITTEE_USERS,e);return t||[]},byId:async e=>{const{data:t}=await D.get(`${w.USERS}/${e}`);return t.data},create:async e=>{const t=await D.post(w.COMMITTEE_USERS,e);return!t.success&&t.errors&&be.error(Object.values(t.errors).join(", "),{richColors:!0}),t},update:async e=>{const t=await D.put(`${w.COMMITTEE_USERS}/${e.id}`,e);if(!t.success)throw new Error(t.message);return t},delete:async e=>{const t=await D.delete(`${w.USERS}/${e}`);if(!t.success)throw new Error(t.message)}},Ve=e=>M({staleTime:P(1,"week"),queryKey:p.list("committee-staff",e),queryFn:()=>V.list(e),placeholderData:t=>t}),Xe=(e,t)=>M({enabled:!!e,staleTime:P(1,"day"),queryFn:()=>V.byId(e),queryKey:p.detail("committee-staff",e),placeholderData:r=>r,...t}),te={pin:/^\d{14}$/,phoneUz:/^\+998\d{9}$/,uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i},v={required:"Bu maydonni to'ldirish majburiy",fio:"FIO ni kiritish majburiy",position:"Lavozimni tanlash majburiy",pin:"JSHSHIR 14 ta raqamdan iborat bo'lishi kerak",role:"Rolni tanlash majburiy",direction:"Kamida bitta yo'nalish tanlash majburiy",department:"Bo'limni tanlash majburiy",phone:"Telefon raqami formati +998XXXXXXXXX bo'lishi kerak"},B={fullName:n.string({message:v.fio}).min(1,v.required),position:n.string({message:v.position}).min(1,v.required),pin:n.coerce.number({message:v.pin}).transform(e=>e.toString()).refine(e=>te.pin.test(e),{message:v.pin}),role:n.nativeEnum(S,{errorMap:()=>({message:v.role})}),directions:n.preprocess(e=>Array.isArray(e)&&e.length>0?e:void 0,n.array(n.string().trim()).min(1,v.direction).default([])),departmentId:n.string().min(1,v.department),phoneNumber:n.string({message:v.required}).trim().refine(e=>te.phoneUz.test(e),{message:v.phone})},ke=n.object({id:n.string().optional(),...B}).strict().transform(e=>({...e,phoneNumber:e.phoneNumber.startsWith("+")?e.phoneNumber:`+${e.phoneNumber}`,fullName:e.fullName.replace(/\s+/g," ")})),ge=n.object({id:n.union([n.string().uuid(),n.string().regex(te.uuid,{message:"Invalid UUID format"})]),fullName:n.string().trim().min(1),pin:n.union([n.number().transform(e=>e.toString()),n.string().regex(/^\d+$/,{message:v.pin})]),role:n.nativeEnum(S),directions:n.array(n.string()).default([]),department:n.string(),departmentId:n.union([n.number().int().positive(),n.string().transform(e=>parseInt(e))]),position:n.string(),phoneNumber:n.string().regex(te.phoneUz,{message:v.phone}),enabled:n.boolean().default(!0)});n.object(B),n.object({id:n.string(),...Object.fromEntries(Object.entries(B).map(([e,t])=>[e,t.optional()]))}),n.object({...Object.fromEntries(Object.entries(B).map(([e,t])=>[e,t.optional()])),page:n.number().optional().default(1),size:n.number().optional().default(20)});const p=Ie("committee-staffs"),Be=()=>{const e=L();return K({mutationFn:V.create,onMutate:async t=>{await e.cancelQueries({queryKey:p.list("committee-staff")});const r=e.getQueryData(p.list("committee-staff"));if(r){const i={...t,id:-Date.now()};e.setQueryData(p.list("committee-staff"),{...r,content:[...r.content,i]})}return{previousList:r}},onSuccess:t=>{e.invalidateQueries({queryKey:p.list("committee-staff")}),e.setQueryData(p.detail("committee-staff",t.data.id),t)},onError:(t,r,i)=>{i?.previousList&&e.setQueryData(p.list("committee-staff"),i.previousList)}})},We=()=>{const e=L();return K({mutationFn:V.update,onMutate:async t=>{if(!t.id)throw new Error("Cannot update committee-staff without ID");await e.cancelQueries({queryKey:p.detail("committee-staff",t.id)}),await e.cancelQueries({queryKey:p.list("committee-staff")});const r=e.getQueryData(p.detail("committee-staff",t.id)),i=e.getQueryData(p.list("committee-staff"));return e.setQueryData(p.detail("committee-staff",t.id),t),i&&e.setQueryData(p.list("committee-staff"),{...i,content:i.content.map(l=>l.id===t.id?t:l)}),{previousDetail:r,previousList:i}},onSuccess:t=>{t.data.id&&e.setQueryData(p.detail("committee-staff",t.data.id),t),e.invalidateQueries({queryKey:p.list("committee-staff")})},onError:(t,r,i)=>{i?.previousDetail&&e.setQueryData(p.detail("committee-staff",r.id),i.previousDetail),i?.previousList&&e.setQueryData(p.list("committee-staff"),i.previousList)}})},He=()=>{const e=L();return K({mutationFn:V.delete,onMutate:async t=>{await e.cancelQueries({queryKey:p.list("committee-staff")}),await e.cancelQueries({queryKey:p.detail("committee-staff",t)});const r=e.getQueryData(p.list("committee-staff")),i=e.getQueryData(p.detail("committee-staff",t));return r&&e.setQueryData(p.list("committee-staff"),{...r,content:r.content.filter(l=>l.id!==t)}),e.removeQueries({queryKey:p.detail("committee-staff",t)}),{previousList:r,previousDetail:i}},onSuccess:()=>{e.invalidateQueries({queryKey:p.list("committee-staff")})},onError:(t,r,i)=>{i?.previousDetail&&e.setQueryData(p.detail("committee-staff",r),i.previousDetail),i?.previousList&&e.setQueryData(p.list("committee-staff"),i.previousList)}})};function Ge(){const{filters:e}=ce(),{t}=R("common"),{onOpen:r}=re(),{data:i,isLoading:l}=Ve(e),o=He(),m=a=>o.mutate(a),d=a=>r(q.EDIT,{id:a}),u=a=>r(q.VIEW,{id:a}),y=[{maxSize:50,minSize:50,header:t("sequence_number"),cell:a=>a.row.index+1},{accessorKey:"fullName",minSize:250,header:t("short.full_name")},{minSize:170,accessorKey:"pin",header:t("short.pin")},{accessorKey:"department",minSize:300,header:t("committee_division_department")},{minSize:200,accessorKey:"position",header:t("position")},{minSize:150,accessorKey:"role",header:t("role"),cell:({row:a})=>oe(a.original.role,t)},{minSize:100,accessorKey:"enabled",header:t("status"),cell:({row:a})=>le(a.original.enabled,t)},{minSize:180,accessorKey:"phoneNumber",header:t("phone"),cell:({row:a})=>ae(a.original.phoneNumber)},{id:"actions",maxSize:200,minSize:100,cell:({row:a})=>s.jsx(Ce,{showEdit:!0,showView:!0,row:a,showDelete:!0,onView:j=>u(j.original.id),onEdit:j=>d(j.original.id),onDelete:j=>m(j.original.id)})}];return s.jsx(De,{isPaginated:!0,data:i||[],columns:y,isLoading:l,className:"h-[calc(100svh-270px)]"})}const Ae=de.forwardRef(({label:e,children:t,span:r=1,valueType:i="text",formatter:l,className:o},m)=>{const d=de.useMemo(()=>{if(l)return l(t);if(t==null)return"-";switch(i){case"date":return new Date(t).toLocaleString();case"status":return s.jsx(H,{variant:t==="active"?"default":"secondary",children:t});case"tags":return Array.isArray(t)?s.jsx("div",{className:"flex flex-wrap gap-1",children:t.map((u,y)=>s.jsx(H,{variant:"outline",children:u},y))}):t;default:return t}},[t,l,i]);return s.jsxs("div",{ref:m,className:Q(r>1?`col-span-${r}`:"col-span-1",o),children:[s.jsx("div",{className:"text-sm text-gray-500",children:e}),s.jsx("div",{className:"mt-1 font-medium",children:d})]})});Ae.displayName="DescriptionItem";function x({title:e,extra:t,bordered:r=!1,column:i=1,loading:l=!1,children:o,className:m}){const d={1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[Math.min(4,Math.max(1,i))];return l?s.jsxs("div",{className:Q("w-full space-y-4",r&&"border rounded-md",m),children:[e&&s.jsxs(g.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx(k,{className:"h-6 w-32"}),t&&s.jsx(k,{className:"h-9 w-24"})]}),s.jsx(fe,{className:"mb-4"})]}),s.jsx("div",{className:Q("grid gap-4",d),children:Array.from({length:i*2}).map((u,y)=>s.jsxs("div",{className:"space-y-2",children:[s.jsx(k,{className:"h-3 w-20"}),s.jsx(k,{className:"h-5 w-full"})]},y))})]}):s.jsxs("div",{className:Q("w-full",r&&"border rounded-md",m),children:[e&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("div",{className:"text-lg font-medium",children:e}),t&&s.jsx("div",{children:t})]}),s.jsx(fe,{className:"mb-4"})]}),s.jsx("div",{className:Q("grid gap-4",d),children:o})]})}x.Item=Ae;const Je=({data:e})=>{const{t}=R("common");return e?s.jsxs(x,{children:[s.jsx(x.Item,{label:t("short.full_name"),children:e?.fullName},"full_name"),s.jsx(x.Item,{label:t("role"),children:oe(e?.role,t)},"role"),s.jsx(x.Item,{label:t("position"),children:e?.position},"position"),s.jsx(x.Item,{label:t("phone"),children:ae(e?.phoneNumber)},"phone"),s.jsx(x.Item,{label:t("short.pin"),children:e?.pin},"pin"),s.jsx(x.Item,{label:t("committee_division_department"),children:e?.department},"department"),s.jsx(x.Item,{label:t("status"),children:le(!!e?.enabled,t)},"status")]}):null},Ze=/^\+998\d{0,9}$/,ue=g.forwardRef(({value:e,onChange:t,className:r,onValueChange:i,showIcon:l=!1,showCountryCode:o=!0,...m},d)=>{const u=a=>a?(o&&!a.startsWith("+998")&&(a="+998"+a.replace(/\D/g,"")),a=a.replace(/[^\d+]/g,""),Ze.test(a)||(a.startsWith("+998")?a="+998"+a.substring(4).slice(0,9):a=a.slice(0,9)),a):o?"+998":"",y=a=>{const j=u(a.target.value),O={...a,target:{...a.target,value:j}};t?.(O),i?.(j)};return s.jsxs("div",{className:"relative",children:[l&&s.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground size-4","aria-hidden":"true"}),s.jsx(z,{...m,ref:d,type:"tel",className:Q(l&&"pl-9",r),onChange:y,value:u(e||""),placeholder:m.placeholder||"+998 XX XXX XX XX"})]})});ue.displayName="PhoneInput";const Ye={list:async()=>{const{data:e}=await D.get(`${w.DEPARTMENT_SELECT}`);return e.data},getById:async e=>{const{data:t}=await D.get(`${w.DEPARTMENTS}/${e}`);return t.data}},et={list:async()=>{const{data:e}=await D.get(`${w.OFFICE_SELECT}`);return e.data},getById:async e=>{const{data:t}=await D.get(`${w.OFFICES}/${e}`);return t.data}},tt=()=>M({staleTime:P(1,"week"),queryKey:["department-select"],queryFn:()=>et.list()}),st=()=>M({staleTime:P(1,"week"),queryKey:["department-select"],queryFn:()=>Ye.list()}),ye={pin:"",fullName:"",position:"",directions:[],phoneNumber:"",departmentId:"",role:S.HEAD};function rt(){const{data:e,onClose:t,isCreate:r}=re(),{data:i}=st(),l=ee({[S.HEAD]:S.HEAD,[S.MANAGER]:S.MANAGER,[S.CHAIRMAN]:S.CHAIRMAN},"userRoles"),o=ee(Ee,"direction"),m=g.useMemo(()=>ne(i||[]),[i]),d=g.useMemo(()=>e?.id?e?.id:"",[e]),u=we({resolver:ve(ke),defaultValues:ye,mode:"onChange"}),{mutateAsync:y,isPending:a}=Be(),{mutateAsync:j,isPending:O}=We(),{data:f,isLoading:_}=Xe(d);g.useEffect(()=>{f&&!r&&u.reset({pin:f.pin,role:f.role,fullName:f.fullName,position:f.position,directions:f.directions,phoneNumber:f.phoneNumber,departmentId:String(f.departmentId)})},[f,r,u]);const c=g.useCallback(()=>{u.reset(ye),t()},[u,t]),b=g.useCallback(async U=>{try{if(r){if((await y(U)).success)return c(),!0}else if((await j({id:d,...U})).success)return c(),!0;return!1}catch(A){return console.error("[useDistrictForm] Submission error:",A),!1}},[r,d,y,j,c,f]);return{form:u,isCreate:r,isPending:a||O,fetchByIdData:f,userRoleOptions:l,departmentOptions:m,userDirectionOptions:o,onSubmit:b,isFetching:_}}const it=()=>{const{t:e}=R("common"),{isOpen:t,mode:r,onClose:i}=re(),l=Oe(r),{form:o,onSubmit:m,isCreate:d,isPending:u,isFetching:y,fetchByIdData:a,userRoleOptions:j,departmentOptions:O,userDirectionOptions:f}=rt(),_=g.useMemo(()=>ne(j),[]);return s.jsx(Ne,{asForm:!0,open:t,title:l,onClose:i,loading:u,disabled:u,onSubmit:o.handleSubmit(m),children:r===q.VIEW?s.jsx(Je,{data:a}):s.jsx(Fe,{...o,children:s.jsx("div",{className:"space-y-4",children:y&&!d?s.jsx(Te,{length:7}):s.jsxs(g.Fragment,{children:[s.jsx(E,{name:"fullName",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("short.full_name")}),s.jsx(T,{children:s.jsx(z,{placeholder:e("short.full_name"),...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"pin",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("short.pin")}),s.jsx(T,{children:s.jsx(qe,{maxLength:14,placeholder:"142536945201203",...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"position",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("position")}),s.jsx(T,{children:s.jsx(z,{placeholder:e("position"),...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"phoneNumber",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:"Telefon raqami"}),s.jsx(T,{children:s.jsx(ue,{...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"role",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("role")}),s.jsx(T,{children:s.jsxs(G,{...c,value:c.value,onValueChange:b=>{b&&c.onChange(b)},children:[s.jsx(J,{children:s.jsx(Z,{placeholder:e("role")})}),s.jsx(Y,{children:_})]})}),s.jsx(C,{})]})}),s.jsx(E,{name:"departmentId",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("menu.departments")}),s.jsx(T,{children:s.jsxs(G,{...c,value:c.value,onValueChange:b=>{b&&c.onChange(b)},children:[s.jsx(J,{children:s.jsx(Z,{placeholder:e("menu.departments")})}),s.jsx(Y,{children:O})]})}),s.jsx(C,{})]})}),s.jsx(E,{name:"directions",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("directions")}),s.jsx(T,{children:s.jsx(Re,{...c,maxDisplayItems:5,placeholder:e("directions"),options:f})}),s.jsx(C,{})]})})]})})})})},X={list:async e=>{const{data:t}=await D.getWithPagination(w.OFFICE_USERS,e);return t||[]},byId:async e=>{const{data:t}=await D.get(`${w.USERS}/${e}`);return t.data},create:async e=>{const t=await D.post(w.OFFICE_USERS,e);return!t.success&&t.errors&&be.error(Object.values(t.errors).join(", "),{richColors:!0}),t},update:async e=>{const t=await D.put(`${w.OFFICE_USERS}/${e.id}`,e);if(!t.success)throw new Error(t.message);return t},delete:async e=>{const t=await D.delete(`${w.USERS}/${e}`);if(!t.success)throw new Error(t.message)}},nt=e=>M({staleTime:P(1,"week"),queryKey:h.list("territorial-staff",e),queryFn:()=>X.list(e),placeholderData:t=>t}),at=(e,t)=>M({enabled:!!e,staleTime:P(1,"day"),queryFn:()=>X.byId(e),queryKey:h.detail("territorial-staff",e),placeholderData:r=>r,...t}),se={pin:/^\d{14}$/,phone:/^\+998\d{9}$/,uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i},F={required:"Bu maydonni to'ldirish majburiy",fio:"FIO ni kiritish majburiy",position:"Lavozimni tanlash majburiy",pin:"JSHSHIR 14 ta raqamdan iborat bo'lishi kerak",role:"Rolni tanlash majburiy",direction:"Kamida bitta yo'nalish tanlash majburiy",department:"Bo'limni tanlash majburiy",phone:"Telefon raqami formati +998XXXXXXXXX bo'lishi kerak"},W={fullName:n.string({message:F.fio}).min(1,F.required),position:n.string({message:F.position}).min(1,F.required),pin:n.coerce.string({message:F.pin}).transform(e=>e.toString()).refine(e=>se.pin.test(e),{message:F.pin}),role:n.nativeEnum(S,{errorMap:()=>({message:F.role})}),directions:n.preprocess(e=>Array.isArray(e)&&e.length>0?e:void 0,n.array(n.string().trim()).min(1,F.direction).default([])),officeId:n.string().min(1,F.department),phoneNumber:n.string({message:F.required}).trim().refine(e=>se.phone.test(e),{message:F.phone})},ot=n.object({id:n.string().optional(),...W}).strict().transform(e=>({...e,phoneNumber:e.phoneNumber.startsWith("+")?e.phoneNumber:`+${e.phoneNumber}`,fullName:e.fullName.replace(/\s+/g," ")})),xe=n.object({id:n.union([n.string().uuid(),n.string().regex(se.uuid,{message:"Invalid UUID format"})]),fullName:n.string().trim().min(1),pin:n.union([n.number().transform(e=>e.toString()),n.string().regex(/^\d+$/,{message:F.pin})]),role:n.nativeEnum(S),directions:n.array(n.string()).default([]),office:n.string(),officeId:n.union([n.number().int().positive(),n.string().transform(e=>parseInt(e))]),position:n.string(),phoneNumber:n.string().regex(se.phone,{message:F.phone}),enabled:n.boolean().default(!0)});n.object(W),n.object({id:n.string(),...Object.fromEntries(Object.entries(W).map(([e,t])=>[e,t.optional()]))}),n.object({...Object.fromEntries(Object.entries(W).map(([e,t])=>[e,t.optional()])),page:n.number().optional().default(1),size:n.number().optional().default(20)});const h=Ie("territorial-staffs"),lt=()=>{const e=L();return K({mutationFn:X.create,onMutate:async t=>{await e.cancelQueries({queryKey:h.list("territorial-staff")});const r=e.getQueryData(h.list("territorial-staff"));if(r){const i={...t,id:-Date.now()};e.setQueryData(h.list("territorial-staff"),{...r,content:[...r.content,i]})}return{previousList:r}},onSuccess:t=>{e.invalidateQueries({queryKey:h.list("territorial-staff")}),e.setQueryData(h.detail("territorial-staff",t.data.id),t)},onError:(t,r,i)=>{i?.previousList&&e.setQueryData(h.list("territorial-staff"),i.previousList)}})},ct=()=>{const e=L();return K({mutationFn:X.update,onMutate:async t=>{if(!t.id)throw new Error("Cannot update territorial-staff without ID");await e.cancelQueries({queryKey:h.detail("territorial-staff",t.id)}),await e.cancelQueries({queryKey:h.list("territorial-staff")});const r=e.getQueryData(h.detail("territorial-staff",t.id)),i=e.getQueryData(h.list("territorial-staff"));return e.setQueryData(h.detail("territorial-staff",t.id),t),i&&e.setQueryData(h.list("territorial-staff"),{...i,content:i.content.map(l=>l.id===t.id?t:l)}),{previousDetail:r,previousList:i}},onSuccess:t=>{t.data.id&&e.setQueryData(h.detail("territorial-staff",t.data.id),t),e.invalidateQueries({queryKey:h.list("territorial-staff")})},onError:(t,r,i)=>{i?.previousDetail&&e.setQueryData(h.detail("territorial-staff",r.id),i.previousDetail),i?.previousList&&e.setQueryData(h.list("territorial-staff"),i.previousList)}})},ut=()=>{const e=L();return K({mutationFn:X.delete,onMutate:async t=>{await e.cancelQueries({queryKey:h.list("territorial-staff")}),await e.cancelQueries({queryKey:h.detail("territorial-staff",t)});const r=e.getQueryData(h.list("territorial-staff")),i=e.getQueryData(h.detail("territorial-staff",t));return r&&e.setQueryData(h.list("territorial-staff"),{...r,content:r.content.filter(l=>l.id!==t)}),e.removeQueries({queryKey:h.detail("territorial-staff",t)}),{previousList:r,previousDetail:i}},onSuccess:()=>{e.invalidateQueries({queryKey:h.list("territorial-staff")})},onError:(t,r,i)=>{i?.previousDetail&&e.setQueryData(h.detail("territorial-staff",r),i.previousDetail),i?.previousList&&e.setQueryData(h.list("territorial-staff"),i.previousList)}})};function mt(){const{filters:e}=ce(),{t}=R("common"),{onOpen:r}=ie(),{data:i,isLoading:l}=nt(e),o=ut(),m=a=>o.mutate(a),d=a=>r(q.EDIT,{id:a}),u=a=>r(q.VIEW,{id:a}),y=[{maxSize:50,minSize:50,header:t("sequence_number"),cell:a=>a.row.index+1},{accessorKey:"fullName",minSize:250,header:t("short.full_name")},{minSize:170,accessorKey:"pin",header:t("short.pin")},{accessorKey:"office",minSize:300,header:t("territorial_department_name")},{minSize:230,accessorKey:"position",header:t("position")},{minSize:200,accessorKey:"role",header:t("role"),cell:({row:a})=>oe(a.original.role,t)},{minSize:100,accessorKey:"enabled",header:t("status"),cell:({row:a})=>le(a.original.enabled,t)},{minSize:180,accessorKey:"phoneNumber",header:t("phone"),cell:({row:a})=>ae(a.original.phoneNumber)},{id:"actions",maxSize:200,minSize:100,cell:({row:a})=>s.jsx(Ce,{showEdit:!0,showView:!0,row:a,showDelete:!0,onView:j=>u(j.original.id),onEdit:j=>d(j.original.id),onDelete:j=>m(j.original.id)})}];return s.jsx(De,{isPaginated:!0,data:i||[],columns:y,isLoading:l,className:"h-[calc(100svh-270px)]"})}const dt=({data:e})=>{const{t}=R("common");return e?s.jsxs(x,{children:[s.jsx(x.Item,{label:t("short.full_name"),children:e?.fullName},"full_name"),s.jsx(x.Item,{label:t("role"),children:oe(e?.role,t)},"role"),s.jsx(x.Item,{label:t("position"),children:e?.position},"position"),s.jsx(x.Item,{label:t("phone"),children:ae(e?.phoneNumber)},"phone"),s.jsx(x.Item,{label:t("short.pin"),children:e?.pin},"pin"),s.jsx(x.Item,{label:t("territorial_department_name"),children:e?.office},"office"),s.jsx(x.Item,{label:t("status"),children:le(!!e?.enabled,t)},"status")]}):null},Se={pin:"",fullName:"",officeId:"",position:"",directions:[],phoneNumber:"",role:S.REGIONAL};function ft(){const{data:e,onClose:t,isCreate:r}=ie(),{data:i}=tt(),l=ee({[S.REGIONAL]:S.REGIONAL,[S.INSPECTOR]:S.INSPECTOR},"userRoles"),o=ee(Ee,"direction"),m=g.useMemo(()=>ne(i||[]),[i]),d=g.useMemo(()=>e?.id?e?.id:"",[e]),u=we({resolver:ve(ot),defaultValues:Se,mode:"onChange"}),{mutateAsync:y,isPending:a}=lt(),{mutateAsync:j,isPending:O}=ct(),{data:f,isLoading:_}=at(d);g.useEffect(()=>{f&&!r&&u.reset({pin:f.pin,role:f.role,fullName:f.fullName,position:f.position,directions:f.directions,phoneNumber:f.phoneNumber,officeId:String(f.officeId)})},[f,r,u]);const c=g.useCallback(()=>{u.reset(Se),t()},[u,t]),b=g.useCallback(async U=>{try{if(r){if((await y(U)).success)return c(),!0}else if((await j({id:d,...U})).success)return c(),!0;return!1}catch(A){return console.error("[useDistrictForm] Submission error:",A),!1}},[r,d,y,j,c,f]);return{form:u,isCreate:r,isPending:a||O,fetchByIdData:f,userRoleOptions:l,departmentOptions:m,userDirectionOptions:o,onSubmit:b,isFetching:_}}const pt=()=>{const{t:e}=R("common"),{isOpen:t,mode:r,onClose:i}=ie(),l=Oe(r),{form:o,onSubmit:m,isCreate:d,isPending:u,isFetching:y,fetchByIdData:a,userRoleOptions:j,departmentOptions:O,userDirectionOptions:f}=ft(),_=g.useMemo(()=>ne(j),[]);return s.jsx(Ne,{asForm:!0,open:t,title:l,onClose:i,loading:u,disabled:u,onSubmit:o.handleSubmit(m),children:r===q.VIEW?s.jsx(dt,{data:a}):s.jsx(Fe,{...o,children:s.jsx("div",{className:"space-y-4",children:y&&!d?s.jsx(Te,{length:7}):s.jsxs(g.Fragment,{children:[s.jsx(E,{name:"fullName",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("short.full_name")}),s.jsx(T,{children:s.jsx(z,{placeholder:e("short.full_name"),...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"pin",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("short.pin")}),s.jsx(T,{children:s.jsx(qe,{maxLength:14,placeholder:"142536945201203",...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"position",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("position")}),s.jsx(T,{children:s.jsx(z,{placeholder:e("position"),...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"phoneNumber",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:"Telefon raqami"}),s.jsx(T,{children:s.jsx(ue,{...c})}),s.jsx(C,{})]})}),s.jsx(E,{name:"role",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("role")}),s.jsx(T,{children:s.jsxs(G,{...c,value:c.value,onValueChange:b=>{b&&c.onChange(b)},children:[s.jsx(J,{children:s.jsx(Z,{placeholder:e("role")})}),s.jsx(Y,{children:_})]})}),s.jsx(C,{})]})}),s.jsx(E,{name:"officeId",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("menu.departments")}),s.jsx(T,{children:s.jsxs(G,{...c,value:c.value,onValueChange:b=>{b&&c.onChange(b)},children:[s.jsx(J,{children:s.jsx(Z,{placeholder:e("menu.departments")})}),s.jsx(Y,{children:O})]})}),s.jsx(C,{})]})}),s.jsx(E,{name:"directions",control:o.control,render:({field:c})=>s.jsxs(I,{children:[s.jsx(N,{required:!0,children:e("directions")}),s.jsx(T,{children:s.jsx(Re,{...c,maxDisplayItems:5,placeholder:e("directions"),options:f})}),s.jsx(C,{})]})})]})})})})},ht=()=>{const{t:e}=R("common"),{activeTab:t,handleChangeTab:r,onAddCommitteeStaffs:i,onAddTerritorialStaffs:l,isOpenCommitteeStaffs:o,isOpenTerritorialStaffs:m}=ze();return s.jsxs(g.Fragment,{children:[s.jsx(_e,{activeTab:t,title:e("menu.staffs"),onAddCommitteeStaffs:i,onAddTerritorialStaffs:l}),s.jsxs(Me,{className:"mt-3",defaultValue:t,onValueChange:d=>r(d),children:[s.jsxs(Le,{children:[s.jsx(he,{value:$.COMMITTEE_STAFFS,children:e("committee_staffs")}),s.jsx(he,{value:$.TERRITORIAL_STAFFS,children:e("territorial_staffs")})]}),s.jsx(je,{className:"mt-4",value:$.COMMITTEE_STAFFS,children:s.jsx(Ge,{})}),s.jsx(je,{className:"mt-4",value:$.TERRITORIAL_STAFFS,children:s.jsx(mt,{})})]}),o&&s.jsx(it,{}),m&&s.jsx(pt,{})]})},wt=g.memo(ht);export{wt as default};
