import{r as l,u as D,j as i,B as C,s as f,t as T,v as N,w as Q,x,y as A,H as Z,c as k,d as M}from"./index-CjbR5zlf.js";import{C as w,k as j,U as O,g as R,c as B,B as $,F as V,T as W,b as G,d as J,e as X}from"./index-DbdGFxt5.js";import{u as P,f as ee,D as ae,a as te}from"./data-table-row-actions-CWvKL5tc.js";import"./select-CBNmlDFn.js";import{z as u,u as se,t as ie,F as re,a as v,b as I,c as S,d as E,e as H}from"./form-BnLW7AoU.js";import{u as oe}from"./use-translated-object-DhGXam3-.js";import{u as ne}from"./use-ui-action-label-D2tLhJmv.js";import"./vendor-CLh72Zqc.js";import"./eye-CfiRFG4z.js";var b=(e=>(e.HAZARDOUS_FACILITY_TYPE="hazardous-facility-type",e.HAZARDOUS_FACILITY_="territorial-staffs",e))(b||{});const Y=l.memo(({title:e,activeTab:a,onAddHazardousFacilityType:t})=>{const{t:s}=D("common");return i.jsxs("div",{className:"flex justify-between",children:[i.jsx("h5",{className:"text-2xl font-semibold uppercase",children:e}),a===b.HAZARDOUS_FACILITY_TYPE?i.jsxs(C,{onClick:t,children:[i.jsx(w,{}),s("actions.add_hazardous_facility_type")]}):i.jsxs(C,{onClick:()=>{},children:[i.jsx(w,{})," ",s("actions.add_territorial_staff")]})]})});Y.displayName="HazardousFacilityActionButton";const ce=()=>{const{filters:e,setFilters:a}=P({"active-tab":ee.string(b.HAZARDOUS_FACILITY_TYPE)}),{onOpen:t,isOpen:s}=j(),o=l.useMemo(()=>e["active-tab"],[e]),n=l.useCallback(d=>a(m=>({...m,"active-tab":d})),[a]),p=l.useCallback(()=>{t(O.CREATE)},[t]);return{filters:e,activeTab:o,handleChangeTab:n,onAddHazardousFacilityType:p,isOpenHazardousFacilityType:s}},z={list:async e=>{const{data:a}=await f.getWithPagination(T.HAZARDOUS_FACILITY_TYPES,e);return a||[]},byId:async e=>{const{data:a}=await f.get(`${T.HAZARDOUS_FACILITY_TYPES}/${e}`);return a.data},create:async e=>{const a=await f.post(T.HAZARDOUS_FACILITY_TYPES,e);return!a.success&&a.errors&&N.error(Object.values(a.errors).join(", "),{richColors:!0}),a},update:async e=>{const a=await f.patch(`${T.HAZARDOUS_FACILITY_TYPES}/${e.id}`,e);if(!a.success)throw new Error(a.message);return a},delete:async e=>{const a=await f.delete(`${T.HAZARDOUS_FACILITY_TYPES}/${e}`);if(!a.success)throw new Error(a.message)}},le=e=>Q({staleTime:R(1,"week"),queryKey:r.list("hazardous-facility-type",e),queryFn:()=>z.list(e),placeholderData:a=>a}),ue=(e,a)=>Q({enabled:!!e,staleTime:R(1,"day"),queryFn:()=>z.byId(e),queryKey:r.detail("hazardous-facility-type",e),placeholderData:t=>t,...a}),F={name:u.string().min(1,"Nomi majburiy"),description:u.string()},U=u.object({id:u.number().optional(),...F});u.object(F),u.object({id:u.number(),...Object.fromEntries(Object.entries(F).map(([e,a])=>[e,a.optional()]))}),u.object({...Object.fromEntries(Object.entries(F).map(([e,a])=>[e,a.optional()])),page:u.number().optional().default(1),size:u.number().optional().default(20)});const r=B("hazardous-facility-type"),de=()=>{const e=x();return A({mutationFn:z.create,onMutate:async a=>{await e.cancelQueries({queryKey:r.list("hazardous-facility-type")});const t=e.getQueryData(r.list("hazardous-facility-type"));if(t){const s={...a,id:-Date.now()};e.setQueryData(r.list("hazardous-facility-type"),{...t,content:[...t.content,s]})}return{previousListData:t}},onSuccess:a=>{e.invalidateQueries({queryKey:r.list("hazardous-facility-type")}),e.setQueryData(r.detail("hazardous-facility-type",a.data.id),a)},onError:(a,t,s)=>{s?.previousListData&&e.setQueryData(r.list("hazardous-facility-type"),s.previousListData)}})},ye=()=>{const e=x();return A({mutationFn:z.update,onMutate:async a=>{if(!a.id)throw new Error("Cannot update updatingData without ID");await e.cancelQueries({queryKey:r.detail("hazardous-facility-type",a.id)}),await e.cancelQueries({queryKey:r.list("hazardous-facility-type")});const t=e.getQueryData(r.detail("hazardous-facility-type",a.id)),s=e.getQueryData(r.list("hazardous-facility-type"));return e.setQueryData(r.detail("hazardous-facility-type",a.id),a),s&&e.setQueryData(r.list("hazardous-facility-type"),{...s,content:s.content.map(o=>o.id===a.id?a:o)}),{previousRegionDetail:t,previousListData:s}},onSuccess:a=>{a.data.id&&e.setQueryData(r.detail("hazardous-facility-type",a.data.id),a),e.invalidateQueries({queryKey:r.list("hazardous-facility-type")})},onError:(a,t,s)=>{s?.previousRegionDetail&&e.setQueryData(r.detail("hazardous-facility-type",t.id),s.previousRegionDetail),s?.previousListData&&e.setQueryData(r.list("hazardous-facility-type"),s.previousListData)}})},pe=()=>{const e=x();return A({mutationFn:z.delete,onMutate:async a=>{await e.cancelQueries({queryKey:r.list("hazardous-facility-type")}),await e.cancelQueries({queryKey:r.detail("hazardous-facility-type",a)});const t=e.getQueryData(r.list("hazardous-facility-type")),s=e.getQueryData(r.detail("hazardous-facility-type",a));return t&&e.setQueryData(r.list("hazardous-facility-type"),{...t,content:t.content.filter(o=>o.id!==a)}),e.removeQueries({queryKey:r.detail("hazardous-facility-type",a)}),{previousListData:t,previousDetail:s}},onSuccess:()=>{e.invalidateQueries({queryKey:r.list("hazardous-facility-type")})},onError:(a,t,s)=>{s?.previousDetail&&e.setQueryData(r.detail("hazardous-facility-type",t),s.previousDetail),s?.previousListData&&e.setQueryData(r.list("hazardous-facility-type"),s.previousListData)}})};function me(){return{sphereOptions:oe(Z,"application")}}function he(){const{filters:e}=P(),{t:a}=D("common"),{onOpen:t}=j(),{data:s,isLoading:o}=le(e),{sphereOptions:n}=me();console.log(n);const p=pe(),d=c=>t(O.EDIT,{id:c}),m=c=>p.mutate(c),y=[{maxSize:20,accessorKey:"number",header:a("sequence_number"),cell:c=>c.row.index+1},{accessorKey:"name",header:a("hazardous_facility_type")},{accessorKey:"description",header:a("hazardous_facility_type_description")},{id:"actions",maxSize:40,enableResizing:!1,cell:({row:c})=>i.jsx(ae,{showEdit:!0,row:c,showDelete:!0,onEdit:h=>d(h.original.id),onDelete:h=>m(h.original.id)})}];return i.jsx(te,{isPaginated:!0,columns:y,data:s||[],isLoading:o,className:"h-[calc(100svh-270px)]"})}const q=l.forwardRef(({className:e,...a},t)=>i.jsx("textarea",{className:k("flex min-h-[60px] w-full rounded-md border border-neutral-300 bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-neutral-350 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...a}));q.displayName="Textarea";const L={name:"",description:""};function fe(){const{data:e,onClose:a,isCreate:t}=j(),s=l.useMemo(()=>e?.id?e?.id:0,[e]),o=se({resolver:ie(U),defaultValues:L,mode:"onChange"}),{mutateAsync:n,isPending:p}=de(),{mutateAsync:d,isPending:m}=ye(),{data:y,isLoading:c}=ue(s);l.useEffect(()=>{y&&!t&&o.reset(y)},[y,t,o]);const h=l.useCallback(()=>{o.reset(L),a()},[o,a]),K=l.useCallback(async _=>{try{if(t){if((await n(_)).success)return h(),!0}else if((await d({id:s,..._})).success)return h(),!0;return!1}catch(g){return console.error("[useDistrictForm] Submission error:",g),!1}},[t,s,n,d,h]);return{form:o,isCreate:t,isPending:p||m,fetchedData:y,isFetching:c,onSubmit:K}}const Te=()=>{const{t:e}=D("common"),{isOpen:a,mode:t,onClose:s}=j(),o=ne(t),{form:n,onSubmit:p,isPending:d,isCreate:m,isFetching:y}=fe();return i.jsx($,{asForm:!0,open:a,onClose:s,title:o,loading:d,disabled:d,onSubmit:n.handleSubmit(p),children:i.jsx(re,{...n,children:i.jsx("div",{className:"space-y-4",children:y&&!m?i.jsx(V,{length:2}):i.jsxs(l.Fragment,{children:[i.jsx(v,{name:"name",control:n.control,render:({field:c})=>i.jsxs(I,{children:[i.jsx(S,{children:e("name")}),i.jsx(E,{children:i.jsx(M,{placeholder:e("name"),...c})}),i.jsx(H,{})]})}),i.jsx(v,{name:"description",control:n.control,render:({field:c})=>i.jsxs(I,{children:[i.jsx(S,{children:e("description")}),i.jsx(E,{children:i.jsx(q,{placeholder:e("description"),...c})}),i.jsx(H,{})]})})]})})})})},be=()=>{const{t:e}=D("common"),{activeTab:a,handleChangeTab:t,onAddHazardousFacilityType:s,isOpenHazardousFacilityType:o}=ce();return i.jsxs(l.Fragment,{children:[i.jsx(Y,{activeTab:a,title:e("menu.hazardous_facilities"),onAddHazardousFacilityType:s}),i.jsxs(W,{className:"mt-3",defaultValue:a,onValueChange:n=>t(n),children:[i.jsx(G,{children:i.jsx(J,{value:b.HAZARDOUS_FACILITY_TYPE,children:e("hazardous_facilities_type")})}),i.jsx(X,{className:"mt-4",value:b.HAZARDOUS_FACILITY_TYPE,children:i.jsx(he,{})})]}),o&&i.jsx(Te,{})]})},ve=l.memo(be);export{ve as default};
